---
title: 利用R作聚类分析
author: 悟道
layout: post
permalink: /?p=1990
categories:
  - R
tags:
  - R
---
<table>
  <tr cellpadding=0><td>
    热度:
  </td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun.gif' width=10 height=10 border=0 /></td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun_dark.gif' width=10 height=10 border=0 /></td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun_dark.gif' width=10 height=10 border=0 /></td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun_dark.gif' width=10 height=10 border=0 /></td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun_dark.gif' width=10 height=10 border=0 /></td></tr>
</table>

&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-BEGIN CODE&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;

<div class="wp_codebox">
  <table>
    <tr id="p1990155">
      <td class="code" id="p1990code155">
        <pre class="bash" style="font-family:monospace;">&nbsp;
<span style="color: #666666; font-style: italic;">#!/bin/bash</span>
<span style="color: #666666; font-style: italic;">#############</span>
<span style="color: #666666; font-style: italic;">#CT##########</span>
<span style="color: #666666; font-style: italic;">#############</span>
<span style="color: #666666; font-style: italic;">#set -x</span>
usage<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #7a0874; font-weight: bold;">&#123;</span>
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #cc0000; font-style: italic;">&lt;&lt;EOF
${txtcyn}
Usage:
&nbsp;
$0 options${txtrst}
&nbsp;
${bldblu}Function${txtrst}:
&nbsp;
This script is used to do clustering using kmeans.
&nbsp;
${txtred}Warning${txtrst}: This script can not deal well with one element cluster.
Please check it yourself.
&nbsp;
${txtbld}OPTIONS${txtrst}:
	-f	Data file (with header line, the first column is the
 		rowname, tab seperated)${bldred}[NECESSARY]${txtrst}
		rowname must be unique. If not, use kmeans.uniq.py.
	-c	The number of cluster wanted.${bldred}[NECESSARY]${txtrst}
	-s	Scale or not[${txtred}Default FALSE${txtrst}]
		Accept TRUE.
	-p	Select the optimum cluster number by elbow algorithm. 
		[${txtred}Default FALSE.${txtrst}]
		Accept TRUE. 
		When this is set to TRUE, a plot of within groups
		sum of squares is made. Acroread will open it, you choose the
		cluster number before which there is a sharp decline. Then
		close the opened pdf, you will be asked to input the chosed
		number. When this is TRUE, the number after -c is the expected
		maximum cluster number. All number of clusters ranges from 2
		to maximum cluster number will be calculated.
	-t	Give the maximum try number to run kmeans multiple times and
		choose the one with the least withinss.
		[${txtred}Default 10.${txtrst}]
	-x	The xlab of cluster.[default Value]
	-y	The ylab of cluster.[default Variable]
	-m	The title of the picture.[default '']
	-l	Parameters for lines.py. [The ones after filename, such as "1
	0 '' '' xlabel ylabel title"]
EOF</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
&nbsp;
<span style="color: #007800;">file</span>=
<span style="color: #007800;">center</span>=
<span style="color: #007800;">scale</span>=<span style="color: #ff0000;">'FALSE'</span>
<span style="color: #007800;">plotwithinss</span>=<span style="color: #ff0000;">'FALSE'</span>
<span style="color: #007800;">try</span>=<span style="color: #000000;">10</span>
<span style="color: #007800;">xlab</span>=<span style="color: #ff0000;">'Value'</span>
<span style="color: #007800;">ylab</span>=<span style="color: #ff0000;">'Variable'</span>
<span style="color: #007800;">mainT</span>=<span style="color: #ff0000;">''</span>
<span style="color: #007800;">ly</span>=<span style="color: #ff0000;">''</span>
<span style="color: #000000; font-weight: bold;">while</span> <span style="color: #7a0874; font-weight: bold;">getopts</span> <span style="color: #ff0000;">"hf:c:s:p:t:x:y:m:l:"</span> OPTION
<span style="color: #000000; font-weight: bold;">do</span>
	<span style="color: #000000; font-weight: bold;">case</span> <span style="color: #007800;">$OPTION</span> <span style="color: #000000; font-weight: bold;">in</span>
		h<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			usage
			<span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">1</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		f<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">file</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		c<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">center</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		s<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">scale</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		p<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">plotwithinss</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		t<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">try</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		x<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">xlab</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		y<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">ylab</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		m<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">mainT</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		l<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">ly</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		?<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			usage
			<span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">1</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
	<span style="color: #000000; font-weight: bold;">esac</span>
<span style="color: #000000; font-weight: bold;">done</span>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #660033;">-z</span> <span style="color: #007800;">$file</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
	usage
	<span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">1</span>
<span style="color: #000000; font-weight: bold;">fi</span>
<span style="color: #007800;">mid</span>=<span style="color: #ff0000;">''</span>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">"<span style="color: #007800;">$scale</span>"</span> == <span style="color: #ff0000;">'TRUE'</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
	<span style="color: #007800;">mid</span>=<span style="color: #ff0000;">'.scale'</span>
<span style="color: #000000; font-weight: bold;">fi</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">"<span style="color: #007800;">$plotwithinss</span>"</span> == <span style="color: #ff0000;">'TRUE'</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
	<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">&lt;&lt;</span>EOF <span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.chooseClusterNumber.r
data <span style="color: #000000; font-weight: bold;">&lt;</span>- read.table<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">$file</span>"</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">'\t'</span>, <span style="color: #007800;">header</span>=T, row.names=<span style="color: #000000;">1</span>,
check.names=FALSE<span style="color: #7a0874; font-weight: bold;">&#41;</span>
data <span style="color: #000000; font-weight: bold;">&lt;</span>- as.matrix<span style="color: #7a0874; font-weight: bold;">&#40;</span>data<span style="color: #7a0874; font-weight: bold;">&#41;</span>
data <span style="color: #000000; font-weight: bold;">&lt;</span>- data<span style="color: #7a0874; font-weight: bold;">&#91;</span>rowSums<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">data</span>==<span style="color: #000000;"></span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #000000; font-weight: bold;">&lt;</span>ncol<span style="color: #7a0874; font-weight: bold;">&#40;</span>data<span style="color: #7a0874; font-weight: bold;">&#41;</span>,<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #000000; font-weight: bold;">if</span><span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$scale</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
	kdata <span style="color: #000000; font-weight: bold;">&lt;</span>- scale<span style="color: #7a0874; font-weight: bold;">&#40;</span>data<span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span><span style="color: #000000; font-weight: bold;">else</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
	kdata <span style="color: #000000; font-weight: bold;">&lt;</span>- data
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
&nbsp;
wss <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #7a0874; font-weight: bold;">&#40;</span>nrow<span style="color: #7a0874; font-weight: bold;">&#40;</span>kdata<span style="color: #7a0874; font-weight: bold;">&#41;</span>-<span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #000000; font-weight: bold;">*</span><span style="color: #c20cb9; font-weight: bold;">sum</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>apply<span style="color: #7a0874; font-weight: bold;">&#40;</span>kdata,<span style="color: #000000;">2</span>,var<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000;">2</span>:<span style="color: #007800;">$center</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> wss<span style="color: #7a0874; font-weight: bold;">&#91;</span>i<span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #c20cb9; font-weight: bold;">sum</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>kmeans<span style="color: #7a0874; font-weight: bold;">&#40;</span>kdata, <span style="color: #007800;">centers</span>=i,
	iter.max=<span style="color: #000000;">100</span>, <span style="color: #007800;">nstart</span>=<span style="color: #000000;">10</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>\<span style="color: #007800;">$withinss</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
&nbsp;
pdf<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.chooseClusterNumber.pdf"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
plot<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">1</span>:<span style="color: #007800;">$center</span>, wss, <span style="color: #007800;">type</span>=<span style="color: #ff0000;">"b"</span>, <span style="color: #007800;">xlab</span>=<span style="color: #ff0000;">"Number of Clusters"</span>, <span style="color: #007800;">ylab</span>=<span style="color: #ff0000;">"Within
groups sum of squares"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
&nbsp;
EOF
&nbsp;
Rscript <span style="color: #660033;">--save</span> <span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.chooseClusterNumber.r
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #007800;">$?</span> == <span style="color: #000000;"></span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
acroread <span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.chooseClusterNumber.pdf
&nbsp;
<span style="color: #c20cb9; font-weight: bold;">read</span> <span style="color: #660033;">-p</span> <span style="color: #ff0000;">"&gt;&gt;&gt;Input the cluster number : "</span> center
<span style="color: #000000; font-weight: bold;">else</span>
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"Wrong Rscript"</span>
<span style="color: #000000; font-weight: bold;">fi</span>
<span style="color: #000000; font-weight: bold;">fi</span>
&nbsp;
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">&lt;&lt;</span>EOF <span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.r
library<span style="color: #7a0874; font-weight: bold;">&#40;</span>cluster<span style="color: #7a0874; font-weight: bold;">&#41;</span>
library<span style="color: #7a0874; font-weight: bold;">&#40;</span>psych<span style="color: #7a0874; font-weight: bold;">&#41;</span>
library<span style="color: #7a0874; font-weight: bold;">&#40;</span>fpc<span style="color: #7a0874; font-weight: bold;">&#41;</span>
data <span style="color: #000000; font-weight: bold;">&lt;</span>- read.table<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">$file</span>"</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">'\t'</span>, <span style="color: #007800;">header</span>=T, row.names=<span style="color: #000000;">1</span>,
check.names=FALSE<span style="color: #7a0874; font-weight: bold;">&#41;</span>
data <span style="color: #000000; font-weight: bold;">&lt;</span>- as.matrix<span style="color: #7a0874; font-weight: bold;">&#40;</span>data<span style="color: #7a0874; font-weight: bold;">&#41;</span>
data <span style="color: #000000; font-weight: bold;">&lt;</span>- data<span style="color: #7a0874; font-weight: bold;">&#91;</span>rowSums<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">data</span>==<span style="color: #000000;"></span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #000000; font-weight: bold;">&lt;</span>ncol<span style="color: #7a0874; font-weight: bold;">&#40;</span>data<span style="color: #7a0874; font-weight: bold;">&#41;</span>,<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #000000; font-weight: bold;">if</span><span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$scale</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
	kdata <span style="color: #000000; font-weight: bold;">&lt;</span>- scale<span style="color: #7a0874; font-weight: bold;">&#40;</span>data<span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span><span style="color: #000000; font-weight: bold;">else</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
	kdata <span style="color: #000000; font-weight: bold;">&lt;</span>- data
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"Try kmeans for the first time."</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
fit <span style="color: #000000; font-weight: bold;">&lt;</span>- kmeans<span style="color: #7a0874; font-weight: bold;">&#40;</span>kdata, <span style="color: #007800;">centers</span>=<span style="color: #007800;">$center</span>, iter.max=<span style="color: #000000;">100</span>, <span style="color: #007800;">nstart</span>=<span style="color: #000000;">10</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
withinss <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #c20cb9; font-weight: bold;">sum</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>fit\<span style="color: #007800;">$withinss</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span>paste<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"Get withinss for the first run"</span>, withinss<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000;">1</span>:<span style="color: #007800;">$try</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span>
	tmpfit <span style="color: #000000; font-weight: bold;">&lt;</span>- kmeans<span style="color: #7a0874; font-weight: bold;">&#40;</span>kdata, <span style="color: #007800;">centers</span>=<span style="color: #007800;">$center</span>, iter.max=<span style="color: #000000;">100</span>, <span style="color: #007800;">nstart</span>=<span style="color: #000000;">10</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	tmpwithinss <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #c20cb9; font-weight: bold;">sum</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>tmpfit\<span style="color: #007800;">$withinss</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span>paste<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"The added "</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>, i, <span style="color: #ff0000;">'run, withinss'</span>, tmpwithinss<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span>tmpwithinss <span style="color: #000000; font-weight: bold;">&lt;</span> withinss<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
		withins <span style="color: #000000; font-weight: bold;">&lt;</span>- tmpwithinss
		fit <span style="color: #000000; font-weight: bold;">&lt;</span>- tmpfit
	<span style="color: #7a0874; font-weight: bold;">&#125;</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"Output the mean value of cluster"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
cluster.mean <span style="color: #000000; font-weight: bold;">&lt;</span>- aggregate<span style="color: #7a0874; font-weight: bold;">&#40;</span>data, <span style="color: #007800;">by</span>=list<span style="color: #7a0874; font-weight: bold;">&#40;</span>fit\<span style="color: #007800;">$cluster</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>, <span style="color: #007800;">FUN</span>=mean<span style="color: #7a0874; font-weight: bold;">&#41;</span>
cluster.mean.colnames <span style="color: #000000; font-weight: bold;">&lt;</span>- colnames<span style="color: #7a0874; font-weight: bold;">&#40;</span>cluster.mean<span style="color: #7a0874; font-weight: bold;">&#41;</span>
cluster.mean.colnames<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> = paste<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'#'</span>,cluster.mean.colnames<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">''</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
colnames<span style="color: #7a0874; font-weight: bold;">&#40;</span>cluster.mean<span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #000000; font-weight: bold;">&lt;</span>- cluster.mean.colnames
write.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>t<span style="color: #7a0874; font-weight: bold;">&#40;</span>cluster.mean<span style="color: #7a0874; font-weight: bold;">&#41;</span>, <span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.mean.lines"</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">'\t'</span>,col.names=F, row.names=T, <span style="color: #007800;">quote</span>=F<span style="color: #7a0874; font-weight: bold;">&#41;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"Output the total sorted cluster name"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
clust.out <span style="color: #000000; font-weight: bold;">&lt;</span>- fit\<span style="color: #007800;">$cluster</span>
kclust <span style="color: #000000; font-weight: bold;">&lt;</span>- as.matrix<span style="color: #7a0874; font-weight: bold;">&#40;</span>clust.out<span style="color: #7a0874; font-weight: bold;">&#41;</span>
kclust.out <span style="color: #000000; font-weight: bold;">&lt;</span>- cbind<span style="color: #7a0874; font-weight: bold;">&#40;</span>kclust, data<span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #666666; font-style: italic;">#means of n points in each cluster</span>
mns <span style="color: #000000; font-weight: bold;">&lt;</span>- sapply<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #c20cb9; font-weight: bold;">split</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>data, fit\<span style="color: #007800;">$cluster</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>, <span style="color: #000000; font-weight: bold;">function</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>x<span style="color: #7a0874; font-weight: bold;">&#41;</span> mean<span style="color: #7a0874; font-weight: bold;">&#40;</span>unlist<span style="color: #7a0874; font-weight: bold;">&#40;</span>x<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #666666; font-style: italic;">#order the data</span>
data.order <span style="color: #000000; font-weight: bold;">&lt;</span>- data<span style="color: #7a0874; font-weight: bold;">&#91;</span>order<span style="color: #7a0874; font-weight: bold;">&#40;</span>order<span style="color: #7a0874; font-weight: bold;">&#40;</span>mns<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#91;</span>fit\<span style="color: #007800;">$cluster</span><span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>,<span style="color: #7a0874; font-weight: bold;">&#93;</span>
write.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>data.order, <span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.result"</span>, 
<span style="color: #007800;">sep</span>=<span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\t</span>"</span>, row.names=T, col.names=T, <span style="color: #007800;">quote</span>=F<span style="color: #7a0874; font-weight: bold;">&#41;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"Plot the cluster data"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> 
png<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.result.png"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
xlabels <span style="color: #000000; font-weight: bold;">&lt;</span>- colnames<span style="color: #7a0874; font-weight: bold;">&#40;</span>data<span style="color: #7a0874; font-weight: bold;">&#41;</span>
ylabels <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #c20cb9; font-weight: bold;">rev</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>rownames<span style="color: #7a0874; font-weight: bold;">&#40;</span>data<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
colN <span style="color: #000000; font-weight: bold;">&lt;</span>- ncol<span style="color: #7a0874; font-weight: bold;">&#40;</span>data.order<span style="color: #7a0874; font-weight: bold;">&#41;</span>
rowN <span style="color: #000000; font-weight: bold;">&lt;</span>- nrow<span style="color: #7a0874; font-weight: bold;">&#40;</span>data.order<span style="color: #7a0874; font-weight: bold;">&#41;</span>
image<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">1</span>:colN, <span style="color: #000000;">1</span>:rowN, t<span style="color: #7a0874; font-weight: bold;">&#40;</span>data.order<span style="color: #7a0874; font-weight: bold;">&#41;</span>, <span style="color: #007800;">xlab</span>=<span style="color: #ff0000;">"<span style="color: #007800;">$xlab</span>"</span>,
<span style="color: #007800;">ylab</span>=<span style="color: #ff0000;">"<span style="color: #007800;">$ylab</span>"</span>, <span style="color: #007800;">main</span>=<span style="color: #ff0000;">"<span style="color: #007800;">$mainT</span>"</span>, <span style="color: #007800;">xaxt</span>=<span style="color: #ff0000;">'n'</span>, <span style="color: #007800;">las</span>=<span style="color: #000000;">2</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
axis<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">1</span>, <span style="color: #007800;">at</span>=<span style="color: #000000;">1</span>:colN, <span style="color: #007800;">labels</span>=xlabels<span style="color: #7a0874; font-weight: bold;">&#41;</span>
axis<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">2</span>, <span style="color: #007800;">at</span>=<span style="color: #000000;">1</span>:rowN, <span style="color: #007800;">labels</span>=ylabels<span style="color: #7a0874; font-weight: bold;">&#41;</span>
dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"Output by cluster"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #000000; font-weight: bold;">for</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000;">1</span>:<span style="color: #007800;">$center</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
	cluster <span style="color: #000000; font-weight: bold;">&lt;</span>- data<span style="color: #7a0874; font-weight: bold;">&#91;</span>kclust.out<span style="color: #7a0874; font-weight: bold;">&#91;</span>,<span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>==i,<span style="color: #7a0874; font-weight: bold;">&#93;</span>
	<span style="color: #000000; font-weight: bold;">if</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>is.vector<span style="color: #7a0874; font-weight: bold;">&#40;</span>cluster<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span> <span style="color: #666666; font-style: italic;">#means only one value</span>
		cluster <span style="color: #000000; font-weight: bold;">&lt;</span>- t<span style="color: #7a0874; font-weight: bold;">&#40;</span>as.matrix<span style="color: #7a0874; font-weight: bold;">&#40;</span>cluster<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #666666; font-style: italic;">#have not tested</span>
	<span style="color: #7a0874; font-weight: bold;">&#125;</span>
	file_clu = paste<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster"</span>, i, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">'.'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	write.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>cluster, <span style="color: #007800;">file</span>=file_clu, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\t</span>"</span>, row.names=T,
	col.names=T, <span style="color: #007800;">quote</span>=F<span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"Principle components plot"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
png<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.pc.png"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
data.p <span style="color: #000000; font-weight: bold;">&lt;</span>- prop.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>data, <span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #000000; font-weight: bold;">*</span><span style="color: #000000;">100</span>
clusplot<span style="color: #7a0874; font-weight: bold;">&#40;</span>data.p, fit\<span style="color: #007800;">$cluster</span>, <span style="color: #007800;">shade</span>=F, <span style="color: #007800;">labels</span>=<span style="color: #000000;">5</span>, <span style="color: #007800;">lines</span>=<span style="color: #000000;"></span>, <span style="color: #007800;">color</span>=T,
<span style="color: #007800;">lty</span>=<span style="color: #000000;">4</span>, <span style="color: #007800;">main</span>=<span style="color: #ff0000;">'Principal Components plot showing K-means clusters'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
png<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.png"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
clusplot<span style="color: #7a0874; font-weight: bold;">&#40;</span>data, fit\<span style="color: #007800;">$cluster</span>, <span style="color: #007800;">shade</span>=T, <span style="color: #007800;">labels</span>=<span style="color: #000000;">5</span>, <span style="color: #007800;">lines</span>=<span style="color: #000000;"></span>, <span style="color: #007800;">color</span>=T,
<span style="color: #007800;">lty</span>=<span style="color: #000000;">4</span>, <span style="color: #007800;">main</span>=<span style="color: #ff0000;">'K-means clusters'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
png<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.centroid.png"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
plotcluster<span style="color: #7a0874; font-weight: bold;">&#40;</span>data, fit\<span style="color: #007800;">$cluster</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
kclust.out.p <span style="color: #000000; font-weight: bold;">&lt;</span>- prop.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>as.matrix<span style="color: #7a0874; font-weight: bold;">&#40;</span>kclust.out<span style="color: #7a0874; font-weight: bold;">&#41;</span>,<span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #000000; font-weight: bold;">*</span><span style="color: #000000;">100</span>
out <span style="color: #000000; font-weight: bold;">&lt;</span>- capture.output<span style="color: #7a0874; font-weight: bold;">&#40;</span>describe.by<span style="color: #7a0874; font-weight: bold;">&#40;</span>kclust.out.p, kclust<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #c20cb9; font-weight: bold;">cat</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>out, <span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.result.pc"</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">'\n'</span>, <span style="color: #007800;">append</span>=F<span style="color: #7a0874; font-weight: bold;">&#41;</span>
EOF
&nbsp;
<span style="color: #000000; font-weight: bold;">for</span> i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">ls</span> <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.[0-9]"</span><span style="color: #000000; font-weight: bold;">`</span>; <span style="color: #000000; font-weight: bold;">do</span>
	<span style="color: #000000; font-weight: bold;">/</span>bin<span style="color: #000000; font-weight: bold;">/</span><span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #660033;">-f</span> <span style="color: #007800;">$i</span>
<span style="color: #000000; font-weight: bold;">done</span>
&nbsp;
Rscript <span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.r
<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">&gt;&</span><span style="color: #000000;">2</span> <span style="color: #ff0000;">"Please pay attention to one element cluster and correct thenthe result."</span>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #007800;">$?</span> == <span style="color: #000000;"></span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
	lines.py <span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.mean.lines <span style="color: #800000;">${ly}</span>
<span style="color: #000000; font-weight: bold;">for</span> i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">ls</span> <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #ff0000;">"<span style="color: #007800;">${file}</span><span style="color: #007800;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.[0-9]"</span><span style="color: #000000; font-weight: bold;">`</span>; <span style="color: #000000; font-weight: bold;">do</span>
	<span style="color: #c20cb9; font-weight: bold;">awk</span> <span style="color: #ff0000;">'BEGIN{OFS="\t" }{if(NR==1){print "#",$0}else print $0}'</span> <span style="color: #007800;">$i</span> <span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #007800;">$i</span>.tmp
	transpose.py <span style="color: #007800;">$i</span>.tmp <span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #007800;">$i</span>.lines
	<span style="color: #000000; font-weight: bold;">/</span>bin<span style="color: #000000; font-weight: bold;">/</span><span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #660033;">-f</span> <span style="color: #007800;">$i</span>.tmp
<span style="color: #000000; font-weight: bold;">done</span>
<span style="color: #000000; font-weight: bold;">else</span>
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"Wrong"</span>
<span style="color: #000000; font-weight: bold;">fi</span>
<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #000000; font-weight: bold;">&lt;&lt;</span>EOF <span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.makefile
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.centroid.png:
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The centroid plot against 1st 2 discriminant functions."</span>
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.mean.lines
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The mean value in each cluster."</span>
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.mean.lines.eps \
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.mean.lines.pdf:
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The plot of mean value in each cluster."</span>
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.mean.lines.plt:
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The gnuplot script to produce the picture."</span>
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.chooseClusterNumberr.pdf:
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The picture for choosing the best number of clusters, which
	shows the changes of within-cluster sum of squares."</span>
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.chooseClusterNumber.r:
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The script to choose the optimum number of clusters."</span>
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.clustster.<span style="color: #000000; font-weight: bold;">*</span>:
&nbsp;
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.1.lines
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.2
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.2.lines
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.3
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.cluster.3.lines
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.pc.png
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.png
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.r
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.result:
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The sorted kmeans result."</span>
<span style="color: #800000;">${file}</span><span style="color: #800000;">${mid}</span>.<span style="color: #007800;">$center</span>.kmeans.result.pc:
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"Have no idea what it is. Just copied from otherwhere."</span>
EOF</pre>
      </td>
    </tr>
  </table>
</div>

&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;END of CODE&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;

参考：http://www.mattpeeples.net/kmeans.html

http://www.statmethods.net/advstats/cluster.html

http://www.r-statistics.com/2010/06/clustergram-visualization-and-diagnostics-for-cluster-analysis-r-code/

&nbsp;

http://en.wikipedia.org/wiki/Multispectral\_pattern\_recognition

http://en.wikipedia.org/wiki/K-means%2B%2B