---
title: R分析affymatrix芯片脚本
author: 悟道
layout: post
permalink: /?p=1883
categories:
  - bioinformatics
  - R
tags:
  - affy
  - R
---
<table>
  <tr cellpadding=0><td>
    热度:
  </td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun.gif' width=10 height=10 border=0 /></td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun_dark.gif' width=10 height=10 border=0 /></td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun_dark.gif' width=10 height=10 border=0 /></td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun_dark.gif' width=10 height=10 border=0 /></td><td cellpadding=0><img src='http://210.75.224.29/wordpress/wp-content/plugins/statpresscn/images/sun_dark.gif' width=10 height=10 border=0 /></td></tr>
</table>

<div class="wp_codebox">
  <table>
    <tr id="p1883151">
      <td class="code" id="p1883code151">
        <pre class="make" style="font-family:monospace;">&nbsp;
<span style="color: #666622; font-weight: bold;">include</span> ~<span style="color: #004400;">/</span>home<span style="color: #004400;">/</span>server<span style="color: #004400;">/</span>makefile<span style="color: #004400;">.</span>tm
GPL1261<span style="color: #004400;">-</span><span style="color: #CC2200;">14790</span><span style="color: #004400;">.</span>at<span style="color: #004400;">.</span>refseq<span style="color: #004400;">:</span>
	tail <span style="color: #004400;">-</span>n <span style="color: #004400;">+</span><span style="color: #CC2200;">18</span> GPL1261<span style="color: #004400;">-</span><span style="color: #CC2200;">14790</span><span style="color: #004400;">.</span>txt <span style="color: #004400;">|</span> cut <span style="color: #004400;">-</span>f <span style="color: #CC2200;">1</span><span style="color: #004400;">,</span><span style="color: #CC2200;">13</span> <span style="color: #004400;">|</span> awk <span style="color: #CC2200;">'BEGIN{OFS="<span style="color: #000099; font-weight: bold;">\t</span>";FS="<span style="color: #000099; font-weight: bold;">\t</span>" }{n=split($$2, a, " /// " );for(i in a)print $$1, a[i]}'</span> <span style="color: #004400;">&gt;</span>GPL1261<span style="color: #004400;">-</span><span style="color: #CC2200;">14790</span><span style="color: #004400;">.</span>at<span style="color: #004400;">.</span>refseq
GSE16925<span style="color: #004400;">.</span>expr<span style="color: #004400;">:</span>
	affy_full<span style="color: #004400;">.</span>sh <span style="color: #004400;">-</span>f pheno<span style="color: #004400;">.</span>txt <span style="color: #004400;">-</span>s GSE16925 <span style="color: #004400;">-</span>m <span style="color: #CC2200;">5</span> <span style="color: #004400;">-</span>n <span style="color: #CC2200;">3</span> <span style="color: #004400;">-</span>q TRUE
head<span style="color: #004400;">=$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">shell</span> head <span style="color: #004400;">-</span>n <span style="color: #CC2200;">1</span> GSE16925<span style="color: #004400;">.</span>expr<span style="color: #004400;">&#41;</span>
&nbsp;
GSE16925<span style="color: #004400;">.</span>Ref<span style="color: #004400;">.</span>expr<span style="color: #004400;">:</span> GSE16925<span style="color: #004400;">.</span>expr GPL1261<span style="color: #004400;">-</span><span style="color: #CC2200;">14790</span><span style="color: #004400;">.</span>at<span style="color: #004400;">.</span>refseq
	tail <span style="color: #004400;">-</span>n <span style="color: #004400;">+</span><span style="color: #CC2200;">2</span> GSE16925<span style="color: #004400;">.</span>expr <span style="color: #004400;">|</span> \
	join <span style="color: #004400;">-</span>a1 GPL1261<span style="color: #004400;">-</span><span style="color: #CC2200;">14790</span><span style="color: #004400;">.</span>at<span style="color: #004400;">.</span>refseq <span style="color: #004400;">-</span> <span style="color: #004400;">|</span> cut <span style="color: #004400;">-</span>d <span style="color: #CC2200;">' '</span> <span style="color: #004400;">-</span>f <span style="color: #CC2200;">2</span><span style="color: #004400;">-</span> <span style="color: #004400;">|</span> sed <span style="color: #CC2200;">'s/ /<span style="color: #000099; font-weight: bold;">\t</span>/g'</span> <span style="color: #004400;">|</span> sort <span style="color: #004400;">-</span>k1<span style="color: #004400;">,</span><span style="color: #CC2200;">1</span> <span style="color: #004400;">&gt;</span><span style="color: #000088; font-weight: bold;">$@</span>
	sed <span style="color: #CC2200;">'1 i<span style="color: #000099; font-weight: bold;">\G</span>ene<span style="color: #000099; font-weight: bold;">\t</span>$(head)'</span> <span style="color: #004400;">-</span>i <span style="color: #000088; font-weight: bold;">$@</span>
&nbsp;
&nbsp;
GSE16925<span style="color: #004400;">.</span>Ref<span style="color: #004400;">.</span>expr<span style="color: #004400;">.</span>aPMA<span style="color: #004400;">:</span> GSE16925<span style="color: #004400;">.</span>expr<span style="color: #004400;">.</span>aPMA GPL1261<span style="color: #004400;">-</span><span style="color: #CC2200;">14790</span><span style="color: #004400;">.</span>at<span style="color: #004400;">.</span>refseq
	tail <span style="color: #004400;">-</span>n <span style="color: #004400;">+</span><span style="color: #CC2200;">2</span> GSE16925<span style="color: #004400;">.</span>expr<span style="color: #004400;">.</span>aPMA <span style="color: #004400;">|</span>\
	join GPL1261<span style="color: #004400;">-</span><span style="color: #CC2200;">14790</span><span style="color: #004400;">.</span>at<span style="color: #004400;">.</span>refseq <span style="color: #004400;">-</span> <span style="color: #004400;">|</span> cut <span style="color: #004400;">-</span>d <span style="color: #CC2200;">' '</span> <span style="color: #004400;">-</span>f <span style="color: #CC2200;">2</span><span style="color: #004400;">-</span> <span style="color: #004400;">|</span> sed <span style="color: #CC2200;">'s/ /<span style="color: #000099; font-weight: bold;">\t</span>/g'</span> <span style="color: #004400;">|</span> sort <span style="color: #004400;">-</span>k1<span style="color: #004400;">,</span><span style="color: #CC2200;">1</span> <span style="color: #004400;">&gt;</span><span style="color: #000088; font-weight: bold;">$@</span>
	sed <span style="color: #CC2200;">'1 i<span style="color: #000099; font-weight: bold;">\G</span>ene<span style="color: #000099; font-weight: bold;">\t</span>$(head)'</span> <span style="color: #004400;">-</span>i <span style="color: #000088; font-weight: bold;">$@</span>
&nbsp;
&nbsp;
GSE16925_1_0<span style="color: #004400;">.</span>05_0<span style="color: #004400;">.</span>3<span style="color: #004400;">.</span>deexpr<span style="color: #004400;">.</span>next<span style="color: #004400;">:</span>
	awk <span style="color: #CC2200;">'BEGIN{OFS="<span style="color: #000099; font-weight: bold;">\t</span>";FS="<span style="color: #000099; font-weight: bold;">\t</span>"}NR!=1{if($$3&gt;=1) print $$1}'</span> <span style="color: #004400;">$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span> <span style="color: #004400;">&gt;$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span><span style="color: #004400;">.</span>cl11<span style="color: #004400;">.</span>up
	join <span style="color: #004400;">$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span><span style="color: #004400;">.</span>cl11<span style="color: #004400;">.</span>up GPL1261<span style="color: #004400;">-</span><span style="color: #CC2200;">14790</span><span style="color: #004400;">.</span>at<span style="color: #004400;">.</span>refseq <span style="color: #004400;">|</span> cut <span style="color: #004400;">-</span>d <span style="color: #CC2200;">' '</span> <span style="color: #004400;">-</span>f <span style="color: #CC2200;">2</span> <span style="color: #004400;">|</span> sort <span style="color: #004400;">&gt;$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span><span style="color: #004400;">.</span>cl11<span style="color: #004400;">.</span>up<span style="color: #004400;">.</span>refseq
	awk <span style="color: #CC2200;">'BEGIN{OFS="<span style="color: #000099; font-weight: bold;">\t</span>";FS="<span style="color: #000099; font-weight: bold;">\t</span>"}NR!=1{if($$3&lt;=-1) print $$1}'</span> <span style="color: #004400;">$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span> <span style="color: #004400;">&gt;$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span><span style="color: #004400;">.</span>cl11<span style="color: #004400;">.</span>down
	join <span style="color: #004400;">$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span><span style="color: #004400;">.</span>cl11<span style="color: #004400;">.</span>down GPL1261<span style="color: #004400;">-</span><span style="color: #CC2200;">14790</span><span style="color: #004400;">.</span>at<span style="color: #004400;">.</span>refseq <span style="color: #004400;">|</span> cut <span style="color: #004400;">-</span>f <span style="color: #CC2200;">2</span> <span style="color: #004400;">-</span>d <span style="color: #CC2200;">' '</span> <span style="color: #004400;">|</span> sort <span style="color: #004400;">&gt;$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span><span style="color: #004400;">.</span>cl11<span style="color: #004400;">.</span>down<span style="color: #004400;">.</span>refseq
	<span style="color: #339900; font-style: italic;">#diffComByOneCol.py $(basename $@).cl11.Up GSE16925.expr.aPMA 1 1 | tail -n +2 &gt;$(basename $@).cl11.up.expr </span>
&nbsp;
GSE16925<span style="color: #004400;">.</span>Ref<span style="color: #004400;">.</span>expr<span style="color: #004400;">.</span>aPMA<span style="color: #004400;">.</span>mgi<span style="color: #004400;">:</span>
	join <span style="color: #004400;">-</span>a1 <span style="color: #004400;">$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span> ~<span style="color: #004400;">/</span>home<span style="color: #004400;">/</span>project<span style="color: #004400;">/</span>project5<span style="color: #004400;">/</span>ucsc<span style="color: #004400;">/</span>mm9<span style="color: #004400;">.</span>mgi<span style="color: #004400;">.</span>symbol<span style="color: #004400;">.</span>refseq <span style="color: #004400;">|</span> awk <span style="color: #CC2200;">'BEGIN{OFS="<span style="color: #000099; font-weight: bold;">\t</span>";FS=" "}NR!=1{print $$8, ($$2+$$3+$$4)/3, ($$5+$$6+$$7)/3}'</span> <span style="color: #004400;">|</span> sort <span style="color: #004400;">-</span>k1<span style="color: #004400;">,</span><span style="color: #CC2200;">1</span> <span style="color: #004400;">|</span> sed <span style="color: #CC2200;">'1 i<span style="color: #000099; font-weight: bold;">\G</span>ene<span style="color: #000099; font-weight: bold;">\t</span>CL11<span style="color: #000099; font-weight: bold;">\t</span>mef'</span> <span style="color: #004400;">&gt;</span><span style="color: #000088; font-weight: bold;">$@</span>
&nbsp;
&nbsp;
GSE16925<span style="color: #004400;">.</span>Ref<span style="color: #004400;">.</span>expr<span style="color: #004400;">.</span>mgi<span style="color: #004400;">:</span>
	join <span style="color: #004400;">-</span>a1 <span style="color: #004400;">$</span><span style="color: #004400;">&#40;</span><span style="color: #0000CC; font-weight: bold;">basename</span> <span style="color: #000088; font-weight: bold;">$@</span><span style="color: #004400;">&#41;</span> ~<span style="color: #004400;">/</span>home<span style="color: #004400;">/</span>project<span style="color: #004400;">/</span>project5<span style="color: #004400;">/</span>ucsc<span style="color: #004400;">/</span>mm9<span style="color: #004400;">.</span>mgi<span style="color: #004400;">.</span>symbol<span style="color: #004400;">.</span>refseq <span style="color: #004400;">|</span> awk <span style="color: #CC2200;">'BEGIN{OFS="<span style="color: #000099; font-weight: bold;">\t</span>";FS=" "}NR!=1{print $$8, ($$2+$$3+$$4)/3, ($$5+$$6+$$7)/3}'</span> <span style="color: #004400;">|</span> sort <span style="color: #004400;">-</span>k1<span style="color: #004400;">,</span><span style="color: #CC2200;">1</span> <span style="color: #004400;">|</span> sed <span style="color: #CC2200;">'1 i<span style="color: #000099; font-weight: bold;">\G</span>ene<span style="color: #000099; font-weight: bold;">\t</span>CL11<span style="color: #000099; font-weight: bold;">\t</span>mef'</span> <span style="color: #004400;">&gt;</span><span style="color: #000088; font-weight: bold;">$@</span></pre>
      </td>
    </tr>
  </table>
</div>

#&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;

<div class="wp_codebox">
  <table>
    <tr id="p1883152">
      <td class="code" id="p1883code152">
        <pre class="bash" style="font-family:monospace;">&nbsp;
<span style="color: #666666; font-style: italic;">#!/bin/bash</span>
<span style="color: #666666; font-style: italic;">#########################################</span>
<span style="color: #666666; font-style: italic;">#Data and format in &lt;sample.cor&gt;</span>
<span style="color: #666666; font-style: italic;">#Control must befor treated sample.</span>
<span style="color: #666666; font-style: italic;">#---here ends content(this line and '#' not included)---------------</span>
<span style="color: #666666; font-style: italic;">#Cel file	Sample</span>
<span style="color: #666666; font-style: italic;">#1.cel	control-1</span>
<span style="color: #666666; font-style: italic;">#2.cel	control-2</span>
<span style="color: #666666; font-style: italic;">#3.cel	control-3</span>
<span style="color: #666666; font-style: italic;">#4.cel	MUT2-1</span>
<span style="color: #666666; font-style: italic;">#5.cel	MUT2-2</span>
<span style="color: #666666; font-style: italic;">#6.cel	MUT2-3</span>
<span style="color: #666666; font-style: italic;">#---here ends content(this line and '#' not included)---------------</span>
<span style="color: #666666; font-style: italic;">#Notes:The second column must not have same sample names</span>
<span style="color: #666666; font-style: italic;">#########################################</span>
<span style="color: #666666; font-style: italic;">#Notes:</span>
<span style="color: #666666; font-style: italic;">#1.Chips based on different platform, like different GRL </span>
<span style="color: #666666; font-style: italic;">#number can not read together. </span>
<span style="color: #666666; font-style: italic;">#If this happens, error message 错误于read.affybatch(filenames = l$filenames, phenoData = l$phenoData,  : </span>
<span style="color: #666666; font-style: italic;">#  Cel file Name_UN-1.CEL does not seem to have the correct dimensions</span>
<span style="color: #666666; font-style: italic;">#2.</span>
<span style="color: #666666; font-style: italic;">#########################################</span>
&nbsp;
usage<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #7a0874; font-weight: bold;">&#123;</span>
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #cc0000; font-style: italic;">&lt;&lt;EOF
${txtcyn}
Usage:
&nbsp;
$0 options${txtrst}
&nbsp;
${bldblu}Function${txtrst}:
&nbsp;
This script is used to analyze affy microarray.
&nbsp;
${txtbld}OPTIONS${txtrst}:
	-f	Data file (with header line, the first column is the
 		cel filename, the second column is the treat methods and
		different repeats, tab seperated)${bldred}[NECESSARY]
		[Control locates before treat]${txtrst}
		name    sample
		GSM723207.CEL   shCntrl1
		GSM723208.CEL   shCntrl2
		GSM723209.CEL   shCntrl3
		GSM723210.CEL   shDot1L1
		GSM723211.CEL   shDot1L2
		GSM723212.CEL   shDot1L3
&nbsp;
	-s	The prefix of output file.
	-i	If error happends when locating the package, plaease use this.
		${bldred}[FALSE]${txtrst}
	-m	The number of rows in layout. When drawing the raw
		image signal, this value is used.
	-n	The number of columns in layout. When drawing the raw 
		image signal, this value is used.
	-a	Execute PMA selection.[Default FALSE, accept TRUE]
	-r	Run the script[default] or only produce the script[FALSE].
	-g	Run DE test or not.[Default FALSE, accept TRUE only if there
		are two conditions in data. When TRUE,
		please supply other needed parameters.]
	-t	The repeat time of treated sample.[integer, default 3]
		{if -t and -c not setted, ${txtrst}no PMA selection.
		This number relates with the number of rows in the last
		integer rows.
		}
	-c	The repeat time of control sample.[integer, default 3]
		{if -t and -c not setted, no PMA selection.
		This number relates with the number of rows in the first
		integer rows.
		}
	-p	The accepted maximum p-value.[default 0.05]
	-d	The accepted maximum fdr.[defaultault 0.3]
	-o	The accepted minimum fold change.
		[log2 based, default 1 means 2 times fold change.]
	-q	Need quality check, such as raw signals, pairwise comparision, 
		degradition, raw boxplot. Only needed when first run.
		[default:FALSE, skip this step. TRUE accepted if you run for 
		the first time.]
EOF</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
&nbsp;
<span style="color: #007800;">file</span>=
<span style="color: #007800;">prefix</span>=
<span style="color: #007800;">install</span>=<span style="color: #ff0000;">'FALSE'</span>
<span style="color: #007800;">pma</span>=<span style="color: #ff0000;">'FALSE'</span>
<span style="color: #007800;">runDE</span>=<span style="color: #ff0000;">'FALSE'</span>
<span style="color: #007800;">rawr</span>=                <span style="color: #666666; font-style: italic;">#rows of raw signal</span>
<span style="color: #007800;">rawc</span>=				 <span style="color: #666666; font-style: italic;">#cols of raw signal</span>
<span style="color: #007800;">run</span>=<span style="color: #ff0000;">'TRUE'</span>
<span style="color: #007800;">controlR</span>=<span style="color: #000000;">3</span>
<span style="color: #007800;">treatR</span>=<span style="color: #000000;">3</span>
<span style="color: #007800;">pvalue</span>=<span style="color: #000000;">0.05</span>
<span style="color: #007800;">fdr</span>=<span style="color: #000000;">0.3</span>
<span style="color: #007800;">foldc</span>=<span style="color: #000000;">1</span>
<span style="color: #007800;">qcheck</span>=FALSE
<span style="color: #000000; font-weight: bold;">while</span> <span style="color: #7a0874; font-weight: bold;">getopts</span> <span style="color: #ff0000;">"hf:s:i:m:n:r:g:t:c:p:d:o:q:"</span> OPTION
<span style="color: #000000; font-weight: bold;">do</span>
	<span style="color: #000000; font-weight: bold;">case</span> <span style="color: #007800;">$OPTION</span> <span style="color: #000000; font-weight: bold;">in</span>
		h<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			usage
			<span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">1</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		f<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">file</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		s<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">prefix</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		i<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">install</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		m<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">rawr</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		n<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">rawc</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		a<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">pma</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		r<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">run</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		g<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">runDE</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		t<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">treatR</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		c<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">controlR</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		p<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">pvalue</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		d<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">fdr</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		o<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">foldc</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		q<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			<span style="color: #007800;">qcheck</span>=<span style="color: #007800;">$OPTARG</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
		?<span style="color: #7a0874; font-weight: bold;">&#41;</span>
			usage
			<span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">1</span>
			<span style="color: #000000; font-weight: bold;">;;</span>
	<span style="color: #000000; font-weight: bold;">esac</span>
<span style="color: #000000; font-weight: bold;">done</span>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #660033;">-z</span> <span style="color: #007800;">$file</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #000000; font-weight: bold;">||</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #660033;">-z</span> <span style="color: #007800;">$prefix</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span>
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"No -f or -s supplied"</span>
	usage
	<span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">1</span>
<span style="color: #000000; font-weight: bold;">fi</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #007800;">$qcheck</span> == <span style="color: #ff0000;">'TRUE'</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #000000; font-weight: bold;">&&</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #660033;">-z</span> <span style="color: #007800;">$rawr</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #000000; font-weight: bold;">||</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #660033;">-z</span> <span style="color: #007800;">$rawc</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #7a0874; font-weight: bold;">&#41;</span>; <span style="color: #000000; font-weight: bold;">then</span>
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"No rawr or rawc for quality check."</span>
	usage
	<span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">1</span>
<span style="color: #000000; font-weight: bold;">fi</span>
&nbsp;
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">&lt;&lt;</span>EOF <span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #007800;">$prefix</span>.r
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$install</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
	<span style="color: #7a0874; font-weight: bold;">source</span><span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"http://bioconductor.org/biocLite.R"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	biocLite<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"affy"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	biocLite<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"genefilter"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	install.packages<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"amap"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
&nbsp;
library<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"affy"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"##reading <span style="color: #007800;">$file</span>"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
pd <span style="color: #000000; font-weight: bold;">&lt;</span>- read.AnnotatedDataFrame<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">$file</span>"</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">'\t'</span>, <span style="color: #007800;">header</span>=TRUE<span style="color: #7a0874; font-weight: bold;">&#41;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'##reading cel files'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
abc <span style="color: #000000; font-weight: bold;">&lt;</span>- ReadAffy<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">filenames</span>=rownames<span style="color: #7a0874; font-weight: bold;">&#40;</span>pData<span style="color: #7a0874; font-weight: bold;">&#40;</span>pd<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>, <span style="color: #007800;">phenoData</span>=pd, 
    <span style="color: #007800;">sampleNames</span>=pData<span style="color: #7a0874; font-weight: bold;">&#40;</span>pd<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#91;</span>,<span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>, <span style="color: #007800;">verbose</span>=TRUE<span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #000000; font-weight: bold;">if</span><span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$qcheck</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'##Begin quality ckeck'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #666666; font-style: italic;">#check the quality of microarray, the more uniform the better. </span>
	<span style="color: #666666; font-style: italic;">#or the less white points the better. Linux and windows may have </span>
	<span style="color: #666666; font-style: italic;">#different picture ways. Here windows preferred.</span>
	<span style="color: #666666; font-style: italic;">#postscript will get a file very large, not recommended here.</span>
	<span style="color: #666666; font-style: italic;">#postscript(file="$prefix.qc.raw.signal.eps", onefile=FALSE, </span>
	<span style="color: #666666; font-style: italic;">#	horizontal=FALSE, paper="special", width=10, height=8, pointsize=10)</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'##Check raw signal'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	jpeg<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.qc.raw.signal.jpg"</span>, <span style="color: #000000;">2049</span>, <span style="color: #000000;">2049</span>, <span style="color: #007800;">res</span>=<span style="color: #000000;">72</span>, <span style="color: #007800;">quality</span>=<span style="color: #000000;">95</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>  <span style="color: #666666; font-style: italic;">#width, height</span>
	<span style="color: #666666; font-style: italic;">#the matrix 6 x 3, must change according to your sample</span>
	par<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">mfrow</span>=c<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$rawr</span>,<span style="color: #007800;">$rawc</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>  
	image<span style="color: #7a0874; font-weight: bold;">&#40;</span>abc<span style="color: #7a0874; font-weight: bold;">&#41;</span>
	dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #666666; font-style: italic;">#needed to save the picture</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'##Pairwise comparision'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #666666; font-style: italic;">#Pairwise comparision. The more linear converge, the better.</span>
	jpeg<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.MA.plot.jpg"</span>, <span style="color: #000000;">2048</span>,<span style="color: #000000;">2048</span>,<span style="color: #007800;">res</span>=<span style="color: #000000;">72</span>,<span style="color: #007800;">quality</span>=<span style="color: #000000;">95</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	MAplot<span style="color: #7a0874; font-weight: bold;">&#40;</span>abc, <span style="color: #007800;">pairs</span>=TRUE, plot.method=<span style="color: #ff0000;">"smoothScatter"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>  <span style="color: #666666; font-style: italic;">#slow</span>
	dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #666666; font-style: italic;">#needed to save the picture</span>
	<span style="color: #666666; font-style: italic;">#The boxplot, to see the expression variation and decide the normalization</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'##Raw signal--boxplot'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	pdf<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.boxplot.raw.signal.pdf"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #666666; font-style: italic;">#las is a parameter of par. 0: always parallel to the axis [_default_],</span>
	<span style="color: #666666; font-style: italic;">#1: always horizontal, 2: always perpendicular to the axis, </span>
	<span style="color: #666666; font-style: italic;">#3: always vertical.</span>
	<span style="color: #666666; font-style: italic;">#But when label is long, it will be cutted of.</span>
	boxplot<span style="color: #7a0874; font-weight: bold;">&#40;</span>abc, <span style="color: #007800;">las</span>=<span style="color: #000000;">2</span>, <span style="color: #007800;">main</span>=<span style="color: #ff0000;">"Boxplot of raw signal"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>  
	dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'##Begin RNA degradition plot'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #666666; font-style: italic;">#QC-RNA degradation plots, mRNA degrades from 5' to 3'.</span>
	deg <span style="color: #000000; font-weight: bold;">&lt;</span>- AffyRNAdeg<span style="color: #7a0874; font-weight: bold;">&#40;</span>abc<span style="color: #7a0874; font-weight: bold;">&#41;</span>
	summaryAffyRNAdeg<span style="color: #7a0874; font-weight: bold;">&#40;</span>deg<span style="color: #7a0874; font-weight: bold;">&#41;</span>  <span style="color: #666666; font-style: italic;">#this is just a show of 'deg' </span>
	jpeg<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.rna.degradation.raw.signal.jpg"</span>, <span style="color: #000000;">800</span>, <span style="color: #000000;">600</span>,<span style="color: #007800;">res</span>=<span style="color: #000000;">72</span>,<span style="color: #007800;">quality</span>=<span style="color: #000000;">95</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	plotAffyRNAdeg<span style="color: #7a0874; font-weight: bold;">&#40;</span>deg, <span style="color: #007800;">transform</span>=<span style="color: #ff0000;">"shift.only"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"##Begin preprocessing data using rma"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #666666; font-style: italic;">#data preprocessing, background correction,normalization and summarization</span>
<span style="color: #666666; font-style: italic;">#calculating expression</span>
eset <span style="color: #000000; font-weight: bold;">&lt;</span>- rma<span style="color: #7a0874; font-weight: bold;">&#40;</span>abc<span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #666666; font-style: italic;">#</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"##Normalized boxplot"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #666666; font-style: italic;">#The boxplot, to see the expression variation after normalization</span>
pdf<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.boxplot.normalization.pdf"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
boxplot<span style="color: #7a0874; font-weight: bold;">&#40;</span>as.data.frame<span style="color: #7a0874; font-weight: bold;">&#40;</span>exprs<span style="color: #7a0874; font-weight: bold;">&#40;</span>eset<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>, <span style="color: #007800;">las</span>=<span style="color: #000000;">2</span>, <span style="color: #007800;">main</span>=<span style="color: #ff0000;">"Boxplot of raw signal"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>  
dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"hclust of all samples"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #666666; font-style: italic;">#hcluster of RMA normalization</span>
library<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"amap"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
pdf<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.whole.gene.hcluster.pdf"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #666666; font-style: italic;">#t:returns the transpose of x.</span>
plot<span style="color: #7a0874; font-weight: bold;">&#40;</span>hcluster<span style="color: #7a0874; font-weight: bold;">&#40;</span>t<span style="color: #7a0874; font-weight: bold;">&#40;</span>exprs<span style="color: #7a0874; font-weight: bold;">&#40;</span>eset<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>, <span style="color: #007800;">method</span>=<span style="color: #ff0000;">"pearson"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>, <span style="color: #007800;">hang</span>=-<span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
dev.off<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"#output expression value to <span style="color: #007800;">$prefix</span>.expr"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #666666; font-style: italic;">#output</span>
write.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>exprs<span style="color: #7a0874; font-weight: bold;">&#40;</span>eset<span style="color: #7a0874; font-weight: bold;">&#41;</span>, <span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.expr"</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\t</span>"</span>, 
	row.names=TRUE, col.names=TRUE, <span style="color: #007800;">quote</span>=FALSE<span style="color: #7a0874; font-weight: bold;">&#41;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$pma</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"##Begin PMA detection"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #666666; font-style: italic;">#pMA selection. if a probe is 'A' in all repeated sample no </span>
	<span style="color: #666666; font-style: italic;">#matter control or treated, delete this probe.</span>
	detect <span style="color: #000000; font-weight: bold;">&lt;</span>- exprs<span style="color: #7a0874; font-weight: bold;">&#40;</span>mas5calls<span style="color: #7a0874; font-weight: bold;">&#40;</span>abc, <span style="color: #007800;">alpha1</span>=<span style="color: #000000;">0.01</span>, <span style="color: #007800;">alpha2</span>=<span style="color: #000000;">0.05</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	probe_A <span style="color: #000000; font-weight: bold;">&lt;</span>- c<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	detectRC <span style="color: #000000; font-weight: bold;">&lt;</span>- dim<span style="color: #7a0874; font-weight: bold;">&#40;</span>detect<span style="color: #7a0874; font-weight: bold;">&#41;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'##annotate the probes which are A in all repeats'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #000000; font-weight: bold;">for</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000;">1</span>:detectRC<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
		delete <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #000000;"></span>
		treatDel <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #000000;"></span>
		half = <span style="color: #007800;">$controlR</span>
		<span style="color: #000000; font-weight: bold;">for</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>j <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000;">1</span>:half<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">if</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>detect<span style="color: #7a0874; font-weight: bold;">&#91;</span>i,j<span style="color: #7a0874; font-weight: bold;">&#93;</span>==<span style="color: #ff0000;">'A'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
				treatDel = treatDel + <span style="color: #000000;">1</span>
			<span style="color: #7a0874; font-weight: bold;">&#125;</span>
		<span style="color: #7a0874; font-weight: bold;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">if</span><span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">treatDel</span>==<span style="color: #000000;">3</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
			delete <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #000000;">1</span>
		<span style="color: #7a0874; font-weight: bold;">&#125;</span><span style="color: #000000; font-weight: bold;">else</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
			treatDel <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #000000;"></span>
			<span style="color: #000000; font-weight: bold;">for</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>j <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span>half+<span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>:<span style="color: #7a0874; font-weight: bold;">&#40;</span>half+<span style="color: #007800;">$treatR</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
				<span style="color: #000000; font-weight: bold;">if</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>detect<span style="color: #7a0874; font-weight: bold;">&#91;</span>i,j<span style="color: #7a0874; font-weight: bold;">&#93;</span>==<span style="color: #ff0000;">'A'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
					treatDel = treatDel + <span style="color: #000000;">1</span>
				<span style="color: #7a0874; font-weight: bold;">&#125;</span>
			<span style="color: #7a0874; font-weight: bold;">&#125;</span>
			<span style="color: #000000; font-weight: bold;">if</span><span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">treatDel</span>==<span style="color: #000000;">3</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
				delete <span style="color: #000000; font-weight: bold;">&lt;</span>- <span style="color: #000000;">1</span>
			<span style="color: #7a0874; font-weight: bold;">&#125;</span>
		<span style="color: #7a0874; font-weight: bold;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">if</span><span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">delete</span>==<span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
			probe_A <span style="color: #000000; font-weight: bold;">&lt;</span>- c<span style="color: #7a0874; font-weight: bold;">&#40;</span>probe_A, <span style="color: #000000;"></span><span style="color: #7a0874; font-weight: bold;">&#41;</span> 
		<span style="color: #7a0874; font-weight: bold;">&#125;</span><span style="color: #000000; font-weight: bold;">else</span><span style="color: #7a0874; font-weight: bold;">&#123;</span>
			probe_A <span style="color: #000000; font-weight: bold;">&lt;</span>- c<span style="color: #7a0874; font-weight: bold;">&#40;</span>probe_A, <span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
		<span style="color: #7a0874; font-weight: bold;">&#125;</span>
	<span style="color: #7a0874; font-weight: bold;">&#125;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'Output pma annotated result'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	detect <span style="color: #000000; font-weight: bold;">&lt;</span>- cbind<span style="color: #7a0874; font-weight: bold;">&#40;</span>detect, probe_A<span style="color: #7a0874; font-weight: bold;">&#41;</span>  <span style="color: #666666; font-style: italic;">#only for testing</span>
	write.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>detect, <span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.pma"</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\t</span>"</span>,
		row.names=TRUE, col.names=TRUE, <span style="color: #007800;">quote</span>=FALSE<span style="color: #7a0874; font-weight: bold;">&#41;</span> 
	<span style="color: #666666; font-style: italic;">#combine the probe_A with espression data</span>
	esetN <span style="color: #000000; font-weight: bold;">&lt;</span>- cbind<span style="color: #7a0874; font-weight: bold;">&#40;</span>exprs<span style="color: #7a0874; font-weight: bold;">&#40;</span>eset<span style="color: #7a0874; font-weight: bold;">&#41;</span>, probe_A<span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #666666; font-style: italic;">#delete untrustable data </span>
	filterdProbe <span style="color: #000000; font-weight: bold;">&lt;</span>- subset<span style="color: #7a0874; font-weight: bold;">&#40;</span>esetN, esetN<span style="color: #7a0874; font-weight: bold;">&#91;</span>,<span style="color: #ff0000;">'probe_A'</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>==<span style="color: #000000;"></span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	filterF <span style="color: #000000; font-weight: bold;">&lt;</span>- filterdProbe<span style="color: #7a0874; font-weight: bold;">&#91;</span>,<span style="color: #000000;">1</span>:detectRC<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2</span><span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>
	esetNoA <span style="color: #000000; font-weight: bold;">&lt;</span>- subset<span style="color: #7a0874; font-weight: bold;">&#40;</span>esetN, esetN<span style="color: #7a0874; font-weight: bold;">&#91;</span>,<span style="color: #ff0000;">'probe_A'</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>==<span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #666666; font-style: italic;">#delete the last column</span>
	esetF <span style="color: #000000; font-weight: bold;">&lt;</span>- esetNoA<span style="color: #7a0874; font-weight: bold;">&#91;</span>,<span style="color: #000000;">1</span>:detectRC<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2</span><span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #666666; font-style: italic;">#the final result for t-test</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'output expression daate after filter and filtered probes'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	write.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>esetF, <span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.expr.aPMA"</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\t</span>"</span>, 
		row.names=TRUE, col.names=TRUE, <span style="color: #007800;">quote</span>=FALSE<span style="color: #7a0874; font-weight: bold;">&#41;</span> 
	write.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>filterF, <span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">$prefix</span>.expr.fullA"</span>, <span style="color: #007800;">sep</span>=<span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\t</span>"</span>, 
		row.names=TRUE, col.names=TRUE, <span style="color: #007800;">quote</span>=FALSE<span style="color: #7a0874; font-weight: bold;">&#41;</span> 
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$runDE</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'pick differentiated genes'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	library<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'genefilter'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'t-test'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	Ttest <span style="color: #000000; font-weight: bold;">&lt;</span>- rowttests<span style="color: #7a0874; font-weight: bold;">&#40;</span>esetF, as.factor<span style="color: #7a0874; font-weight: bold;">&#40;</span>c<span style="color: #7a0874; font-weight: bold;">&#40;</span>rep<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">1</span>,<span style="color: #007800;">$controlR</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>,rep<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">2</span>,<span style="color: #007800;">$treatR</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'method "BH" gives the false discovery rate ?p.adjust. We declare a collection of 100 genes with a maximum FDR of 0.10 to be differentially expressed (DE), then we expect a maximum of 10 genes to be false positives.'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	p.adjust <span style="color: #000000; font-weight: bold;">&lt;</span>- p.adjust<span style="color: #7a0874; font-weight: bold;">&#40;</span>Ttest\<span style="color: #007800;">$p</span>.value, <span style="color: #007800;">method</span>=<span style="color: #ff0000;">"BH"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	TtestAdj <span style="color: #000000; font-weight: bold;">&lt;</span>- cbind<span style="color: #7a0874; font-weight: bold;">&#40;</span>Ttest, p.adjust<span style="color: #7a0874; font-weight: bold;">&#41;</span>
	esetFF <span style="color: #000000; font-weight: bold;">&lt;</span>- cbind<span style="color: #7a0874; font-weight: bold;">&#40;</span>esetF, TtestAdj<span style="color: #7a0874; font-weight: bold;">&#41;</span>
	print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">"Output all gene expression with t-test results"</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	write.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>esetFF,
		<span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">${prefix}</span>_<span style="color: #007800;">${foldc}</span>_<span style="color: #007800;">${pvalue}</span>_<span style="color: #007800;">${fdr}</span>.expr.ttest"</span>,
		<span style="color: #007800;">sep</span>=<span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\t</span>"</span>, row.names=TRUE, col.names=TRUE, <span style="color: #007800;">quote</span>=FALSE<span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #666666; font-style: italic;">#diffExpr &lt;- subset(TtestAdjM, abs(TtestAdjM[,'dm'])&gt;=$foldc &&</span>
	<span style="color: #666666; font-style: italic;">#	TtestAdjM[,'p.adjust']&lt;=$fdr && TtestAdjM[,'p.value']&lt;=$pvalue)</span>
	diffExpr <span style="color: #000000; font-weight: bold;">&lt;</span>- subset<span style="color: #7a0874; font-weight: bold;">&#40;</span>TtestAdj, abs<span style="color: #7a0874; font-weight: bold;">&#40;</span>TtestAdj\<span style="color: #007800;">$dm</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #000000; font-weight: bold;">&gt;</span>=<span style="color: #007800;">$foldc</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #666666; font-style: italic;">#diffExpr &lt;- subset(esetFF,</span>
	<span style="color: #666666; font-style: italic;">#abs(rowSums(esetFF[,2:$controlR])/rowSums(esetFF[,$controlR+1:$controlR+$treatR]))&gt;=$foldc)</span>
	diffExpr <span style="color: #000000; font-weight: bold;">&lt;</span>- subset<span style="color: #7a0874; font-weight: bold;">&#40;</span>diffExpr, diffExpr\<span style="color: #007800;">$p</span>.value<span style="color: #000000; font-weight: bold;">&lt;</span>=<span style="color: #007800;">$pvalue</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	diffExpr <span style="color: #000000; font-weight: bold;">&lt;</span>- subset<span style="color: #7a0874; font-weight: bold;">&#40;</span>diffExpr, diffExpr\<span style="color: #007800;">$p</span>.adjust<span style="color: #000000; font-weight: bold;">&lt;</span>=<span style="color: #007800;">$fdr</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
	write.table<span style="color: #7a0874; font-weight: bold;">&#40;</span>diffExpr, <span style="color: #007800;">file</span>=<span style="color: #ff0000;">"<span style="color: #007800;">${prefix}</span>_<span style="color: #007800;">${foldc}</span>_<span style="color: #007800;">${pvalue}</span>_<span style="color: #007800;">${fdr}</span>.deexpr"</span>,
		<span style="color: #007800;">sep</span>=<span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\t</span>"</span>, row.names=TRUE, col.names=TRUE, <span style="color: #007800;">quote</span>=FALSE<span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
EOF
&nbsp;
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">"<span style="color: #007800;">$run</span>"</span> = <span style="color: #ff0000;">'TRUE'</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>;<span style="color: #000000; font-weight: bold;">then</span>
	Rscript <span style="color: #007800;">$prefix</span>.r 
<span style="color: #000000; font-weight: bold;">fi</span>
&nbsp;
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">&lt;&lt;</span>EOF <span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #007800;">$prefix</span>.Makefile
<span style="color: #007800;">$prefix</span>.r.CT:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The R script for analysis."</span>
&nbsp;
<span style="color: #007800;">$prefix</span>.MA.plot.jpg.CT:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The pairwise comparision plot to indicate the
	repeatability."</span>
<span style="color: #007800;">$prefix</span>.qc.raw.signal.jpg.CT:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The raw point picture to detect the quality of the
	microarray. If no light points found, good. If run in linux,
	light lines can be irgnored for system reason."</span>
&nbsp;
<span style="color: #007800;">$prefix</span>.boxplot.raw.signal.pdf.CT:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The raw boxplot to see the difference among each sample
	with raw data."</span>
&nbsp;
<span style="color: #007800;">$prefix</span>.boxplot.normalization.pdf.CT:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The raw boxplot to see the difference among each sample
	after normalization."</span>
&nbsp;
<span style="color: #007800;">$prefix</span>.whole.gene.hcluster.pdf.CT:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The cluster of all samples. The tree graph can used
	to tell if your result is right."</span>
&nbsp;
<span style="color: #007800;">$prefix</span>.pma.CT:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The PMA detect result with 0 and 1 annotation in the last
	column. 1 means kept. "</span>
&nbsp;
<span style="color: #007800;">$prefix</span>.expr.CT:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The normalized expression value of all probes."</span>
&nbsp;
<span style="color: #007800;">$prefix</span>.expr.fullA:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The expression value of wrong probes."</span>
&nbsp;
<span style="color: #007800;">$prefix</span>.cor:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The input file of affy_full.sh."</span>
&nbsp;
<span style="color: #007800;">$prefix</span>.t.test:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The filtered expression value with t-test results."</span>
&nbsp;
<span style="color: #800000;">${prefix}</span>_<span style="color: #800000;">${foldc}</span>_<span style="color: #800000;">${pvalue}</span>_<span style="color: #800000;">${fdr}</span>.expr.ttest.CT:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The selected different expressed genes with expressed
	values ttest results."</span>
&nbsp;
<span style="color: #800000;">${prefix}</span>_<span style="color: #800000;">${foldc}</span>_<span style="color: #800000;">${pvalue}</span>_<span style="color: #800000;">${fdr}</span>.deexpr:
	<span style="color: #000000; font-weight: bold;">@</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">"The selected different expressed genes and ttest results."</span>
EOF</pre>
      </td>
    </tr>
  </table>
</div>

Other methods:

http://www.bigre.ulb.ac.be/Users/jvanheld/web\_course\_microarrays/practicals/filtering.html